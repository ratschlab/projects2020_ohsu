tot_batches=10

for batch_id in {1..10}; do 
suffix=batch${batch_id}
outdir=/cluster/work/grlab/projects/projects2020_OHSU/peptides_generation/v2_v2.5f0752a_conf2_annotFrame_cap0_runs_pya0.17.1/TCGA_Breast_1102/filter_TCGA-AO-A0JM-01A-21R-A056-07.all/commit_6e25db6_AllNormals_${batch_id}
idn=Allb${batch_id}

mkdir -p $outdir
cmd="immunopepper cancerspecif --cores 6 --mem-per-core 20000 --kmer 9 --expression-fields-c segmentExpr junctionExpr --path-cancer-matrix-edge /cluster/work/grlab/projects/projects2020_OHSU/peptides_generation/v2_v2.5f0752a_conf2_annotFrame_cap0_runs_pya0.17.1/TCGA_Breast_1102/cohort_mutNone_relink/Junc_BRCA_19077 --ids-cancer-samples TCGA-AO-A0JM-01A-21R-A056-07.all --mut-cancer-samples ref --whitelist-cancer /cluster/work/grlab/projects/projects2020_OHSU/sample_lists/TCGA_foreground/sample_full_BRCA_1102.tsv --path-cancer-libsize /cluster/work/grlab/projects/projects2020_OHSU/peptides_generation/v2_libsizes_conf2_annotFrame_cap1000_runs_pya0.17.1_KEEP/TCGA_Breast_1102/cohort_mutNone/TCGA_Breast_1102_coding_libsize75.tsv --normalizer-cancer-libsize 400000 --whitelist-normal /cluster/work/grlab/projects/projects2020_OHSU/sample_lists/GTEX_and_TCGA_normals/sample_full_All_Normals_plus_GTEx_sample_IDs_10-2021_lib_graph_juliannelist --path-normal-libsize /cluster/work/grlab/projects/projects2020_OHSU/peptides_generation/v2_libsizes_conf2_annotFrame_cap1000_runs_pya0.17.1_KEEP/GTEX2019_copy/GTEX_hg38_TCGA_All_Normals_coding_libsize75.tsv --normalizer-normal-libsize 400000 --output-dir ${outdir} --sample-expr-support-cancer 2 --uniprot /cluster/work/grlab/projects/TCGA/PanCanAtlas/tcga_immuno/uniprot/9mers_uniprot-human-UP000005640_9606.tsv --parallelism 100 --out-partitions 1 --path-normal-matrix-segm /cluster/work/grlab/projects/projects2020_OHSU/peptides_generation/v2_v2.5f0752a_conf2_annotFrame_cap0_runs_pya0.17.1/TCGA_All_Normals/cohort_mutNone_relink/Segm_TCGAnormals_19077 /cluster/work/grlab/projects/projects2020_OHSU/peptides_generation/v2_v2.5f0752a_conf2_annotFrame_cap0_runs_pya0.17.1/TCGA_Breast_1102/cohort_mutNone_relink/Segm_GTEX2019_19077 --path-normal-matrix-edge /cluster/work/grlab/projects/projects2020_OHSU/peptides_generation/v2_v2.5f0752a_conf2_annotFrame_cap0_runs_pya0.17.1/TCGA_All_Normals/cohort_mutNone_relink/Junc_TCGAnormals_19077 /cluster/work/grlab/projects/projects2020_OHSU/peptides_generation/v2_v2.5f0752a_conf2_annotFrame_cap0_runs_pya0.17.1/TCGA_Breast_1102/cohort_mutNone_relink/Junc_GTEX2019_19077 --path-normal-kmer-list /cluster/work/grlab/projects/projects2020_OHSU/peptides_generation/v2_v2.5f0752a_conf2_annotFrame_cap0_runs_pya0.17.1/TCGA_Breast_1102/cohort_mutNone_relink/annot_BRCA_19077 --cohort-expr-support-norm 0 --n-samples-lim-normal 1 --id-normals ${idn} --output-count /cluster/work/grlab/projects/projects2020_OHSU/peptides_generation/v2_v2.5f0752a_conf2_annotFrame_cap0_runs_pya0.17.1/TCGA_Breast_1102/filter_TCGA-AO-A0JM-01A-21R-A056-07.all/filter_summary_file.txt --cohort-expr-support-cancer 1 --n-samples-lim-cancer 1 --tot-batches ${tot_batches} --batch-id ${batch_id} > /cluster/work/grlab/projects/projects2020_OHSU/peptides_generation/v2_v2.5f0752a_conf2_annotFrame_cap0_runs_pya0.17.1/TCGA_Breast_1102/filter_TCGA-AO-A0JM-01A-21R-A056-07.all/commit_6e25db6_AllNormals/TCGA-AO-A0JM-01A-21R-A056-07.all.ref.run_cancerspecif.commit_6e25db6.Cec1.Cn1.Ces.2.Nec0.Nn1_${suffix}.log 2>&1"

echo $cmd | bsub -J test_sparkb -n 6 -W 120:00 -R "rusage[mem=20000]" -R "span[hosts=1]" -R "rusage[scratch=300000]"

done
